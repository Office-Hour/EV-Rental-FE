<mat-sidenav-container class="h-screen flex flex-col bg-white dark:bg-slate-900">
  @if (isHandset$ | async) {
    <mat-sidenav #drawer mode="over">
      <mat-toolbar
        class="border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 backdrop-blur-sm"
      >
        <img class="size-8" src="logo.png" alt="Voltera Logo" />
        <button
          mat-icon-button
          (click)="toggleMenu()"
          class="ml-auto text-gray-900 dark:text-white hover:bg-blue-100 dark:hover:bg-blue-900 hover:text-blue-600 dark:hover:text-blue-400"
        >
          <mat-icon matListItemIcon>menu_opened</mat-icon>
        </button>
      </mat-toolbar>
      <mat-list class="bg-transparent">
        @for (item of navigation; track item) {
          <a
            mat-list-item
            [href]="item.href"
            [activated]="item.current"
            [attr.aria-current]="item.current ? 'page' : undefined"
            class="text-gray-900 dark:text-white hover:bg-blue-100 dark:hover:bg-blue-900 border-l-4 border-transparent hover:border-blue-500 transition-all duration-200 rounded-r-lg mx-2 my-1"
            [class.border-blue-500]="item.current"
            [class.bg-blue-100]="item.current"
            [class.dark:bg-blue-900]="item.current"
          >
            <mat-icon matListItemIcon class="mr-3">{{ item.icon || 'dashboard' }}</mat-icon>
            {{ item.name }}
          </a>
        }
        <mat-divider class="border-gray-200 dark:border-gray-700" />
        <div
          mat-subheader
          class="bg-gray-100 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"
        >
          <div
            class="flex items-center p-3 rounded-lg bg-gray-50 dark:bg-gray-700 backdrop-blur-sm"
          >
            <div class="shrink-0 relative">
              <img
                [src]="user.imageUrl"
                alt=""
                class="size-10 rounded-full object-cover ring-2 ring-blue-200 dark:ring-blue-800"
              />
              <div
                class="absolute -bottom-1 -right-1 size-4 bg-orange-500 rounded-full border-2 border-white dark:border-gray-800"
              ></div>
            </div>
            <div class="ml-3 flex-1 min-w-0">
              <div class="text-base font-semibold text-gray-900 dark:text-white truncate">
                {{ user.name }}
              </div>
              <div class="text-sm font-medium text-gray-600 dark:text-gray-400 truncate">
                {{ user.email }}
              </div>
            </div>
            <button
              mat-icon-button
              class="ml-auto text-gray-900 dark:text-white hover:bg-blue-100 dark:hover:bg-blue-900"
            >
              <mat-icon>notifications</mat-icon>
            </button>
          </div>
        </div>
        @for (item of userNavigation; track item) {
          <a
            mat-list-item
            routerLink="."
            [fragment]="item.href"
            class="text-gray-900 dark:text-white hover:bg-blue-100 dark:hover:bg-blue-900 mx-2 my-1 rounded-lg transition-all duration-200"
          >
            <mat-icon matListItemIcon class="mr-3">{{ item.icon || 'person' }}</mat-icon>
            {{ item.name }}
          </a>
        }
      </mat-list>
    </mat-sidenav>
  }

  <mat-sidenav-content class="flex flex-col min-h-screen bg-gray-50 dark:bg-slate-900 w-full">
    <mat-toolbar
      class="px-0! border-b border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-slate-800 backdrop-blur-md shadow-lg"
    >
      <div class="flex-1 w-full max-w-7xl mx-auto flex items-center px-4 sm:px-6 lg:px-8">
        <img class="size-8" src="logo.png" alt="Voltera Logo" />
        @if ((isHandset$ | async) === false) {
          <div class="ml-10">
            <div class="flex items-baseline space-x-2">
              @for (item of navigation; track item) {
                <a
                  matButton
                  routerLink="."
                  [fragment]="item.href"
                  class="px-4 py-2 font-medium transition-all duration-200"
                >
                  <mat-icon class="mr-2 text-sm">{{ item.icon }}</mat-icon>
                  {{ item.name }}
                </a>
              }
            </div>
          </div>
          <div class="flex items-center gap-2 ml-auto">
            <button
              mat-icon-button
              aria-label="View notifications"
              class="text-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-900 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200"
            >
              <mat-icon>notifications</mat-icon>
            </button>
            <button
              mat-icon-button
              [matMenuTriggerFor]="userMenu"
              aria-label="User menu"
              class="p-1! rounded-full ring-2 ring-transparent hover:ring-blue-300 dark:hover:ring-blue-600 transition-all duration-200"
            >
              <img
                [src]="user.imageUrl"
                alt=""
                class="size-8! rounded-full object-cover ring-2 ring-blue-200 dark:ring-blue-700 hover:ring-blue-300 dark:hover:ring-blue-600 transition-all duration-200"
              />
            </button>
          </div>
        }
        @if (isHandset$ | async) {
          <button
            mat-icon-button
            (click)="toggleMenu()"
            class="ml-auto text-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-900 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200"
          >
            <mat-icon>menu</mat-icon>
          </button>
        }
      </div>
    </mat-toolbar>

    <mat-menu
      #userMenu="matMenu"
      class="bg-white dark:bg-slate-800 backdrop-blur-md border border-gray-200 dark:border-gray-700 shadow-xl"
    >
      @for (item of userNavigation; track item) {
        <a
          mat-menu-item
          routerLink="."
          [fragment]="item.href"
          class="flex items-center gap-3 py-3 px-4 hover:bg-blue-100 dark:hover:bg-blue-900 transition-all duration-200"
        >
          <mat-icon class="text-blue-500">{{ item.icon || 'person' }}</mat-icon>
          <span class="font-medium">{{ item.name }}</span>
        </a>
      }
    </mat-menu>

    <!-- content grow -->
    <div
      class="w-full mx-auto bg-gray-50 dark:bg-slate-900 max-w-7xl px-4 py-8 sm:px-6 lg:px-8 flex-1"
    >
      <router-outlet />
    </div>

    <!-- Footer sticks to bottom -->
    <div
      class="mt-auto bg-gray-100 dark:bg-slate-800 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700 shadow-lg"
    >
      <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8 flex items-center justify-between">
        <span class="text-gray-600 dark:text-gray-400 font-medium">Voltera &copy; 2025</span>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
