<!-- Main Layout Container -->
<mat-sidenav-container class="h-screen flex flex-col bg-surface">
  <!-- Mobile Navigation Sidebar -->
  @if (isHandset$ | async) {
    <mat-sidenav #drawer mode="over">
      <mat-toolbar class="border-b border-outline bg-surface-variant backdrop-blur-sm">
        <div class="logo-container">
          <img class="logo-text" src="logo-text.webp" alt="Voltera Logo" />
          <img class="logo-text-dark" src="logo-text-dark.webp" alt="Voltera Logo" />
        </div>
        <button
          mat-icon-button
          (click)="toggleMenu()"
          class="ml-auto text-on-surface hover-primary"
        >
          <mat-icon matListItemIcon>menu_opened</mat-icon>
        </button>
      </mat-toolbar>
      <mat-list class="bg-transparent">
        <!-- Mobile Navigation - Only for authenticated users -->
        @if (isAuthenticated()) {
          @for (item of navigation(); track item) {
            <a
              mat-list-item
              [href]="item.href"
              class="text-on-surface hover-primary border-l-2 border-transparent hover:border-primary transition-all duration-200 rounded-r-lg mx-2 my-1 cursor-pointer"
              [class.border-primary]="item.current"
              [class.bg-primary-container]="item.current"
              [class.text-primary]="item.current"
              [class.font-semibold]="item.current"
            >
              {{ item.name }}
            </a>
          }
          <mat-divider class="border-outline-variant" />
        }

        @if (isAuthenticated()) {
          <div mat-subheader class="bg-surface-variant border-b border-outline">
            <div class="flex items-center p-3 rounded-lg bg-surface backdrop-blur-sm">
              <div class="shrink-0 relative">
                <img
                  [src]="
                    currentUser()?.userName
                      ? 'https://ui-avatars.com/api/?name=' + currentUser()?.userName
                      : 'https://ui-avatars.com/api/?name=User'
                  "
                  alt=""
                  class="size-10 rounded-full object-cover ring-2 ring-primary"
                />
                <div
                  class="absolute -bottom-1 -right-1 size-4 bg-tertiary rounded-full border-2 border-surface"
                ></div>
              </div>
              <div class="ml-3 flex-1 min-w-0">
                <div class="text-base font-semibold text-on-surface truncate">
                  {{ currentUser()?.userName || 'User' }}
                </div>
                <div class="text-sm font-medium text-on-surface-variant truncate capitalize">
                  {{ currentUser()?.role || 'customer' }}
                </div>
              </div>
              <button mat-icon-button class="ml-auto text-on-surface hover-primary">
                <mat-icon>notifications</mat-icon>
              </button>
            </div>
          </div>
          @for (item of userNavigation(); track item) {
            <a
              mat-list-item
              [routerLink]="item.href"
              (click)="item.action?.()"
              class="text-on-surface hover-primary mx-2 my-1 rounded-lg transition-all duration-200 cursor-pointer"
            >
              {{ item.name }}
            </a>
          }
        } @else {
          @for (item of guestNavigation(); track item) {
            <a
              mat-list-item
              [routerLink]="item.href"
              class="text-on-surface hover-primary hover:text-primary mx-2 my-1 rounded-lg transition-all duration-200 cursor-pointer"
            >
              {{ item.name }}
            </a>
          }
        }
      </mat-list>
    </mat-sidenav>
  }

  <!-- Main Content Area -->
  <mat-sidenav-content class="flex flex-col min-h-screen bg-surface-variant w-full">
    <mat-toolbar
      class="px-0! py-2 border-b border-outline bg-surface/80 backdrop-blur-md shadow-lg"
    >
      <div class="flex-1 w-full max-w-7xl mx-auto flex items-center px-4 sm:px-6 lg:px-8">
        <!-- Logo with hover effect -->
        <a class="logo-container flex items-center w-full justify-center cursor-pointer" href="/">
          <img class="logo-text" src="logo-text.webp" alt="Voltera Logo" />
          <img class="logo-text-dark" src="logo-text-dark.webp" alt="Voltera Logo" />
        </a>

        <!-- Desktop Navigation -->
        @if ((isHandset$ | async) === false) {
          <div class="ml-10">
            <div class="flex items-baseline space-x-2">
              @for (item of navigation(); track item) {
                <a
                  [href]="item.href"
                  matButton
                  class="px-3 py-2 rounded-md transition-all duration-200 relative"
                  [class.text-primary]="item.current"
                  [class.font-semibold]="item.current"
                  [class.hover-primary]="!item.current"
                  [class.text-on-surface]="!item.current"
                >
                  {{ item.name }}
                  <!-- Active indicator border -->
                  @if (item.current) {
                    <div
                      class="absolute bottom-0 left-1/2 transform -translate-x-1/2 w-8 h-0.5 bg-primary rounded-full"
                    ></div>
                  }
                </a>
              }
            </div>
          </div>

          <!-- Authenticated User Actions -->
          @if (isAuthenticated()) {
            <div class="flex items-center gap-2 ml-auto">
              <button
                mat-icon-button
                aria-label="View notifications"
                class="text-on-surface hover-primary transition-all duration-200"
              >
                <mat-icon>notifications</mat-icon>
              </button>
              <button
                mat-icon-button
                [matMenuTriggerFor]="userMenu"
                aria-label="User menu"
                class="p-1! rounded-full ring-2 ring-primary transition-all duration-200"
              >
                <img
                  [src]="
                    currentUser()?.userName
                      ? 'https://ui-avatars.com/api/?name=' + currentUser()?.userName
                      : 'https://ui-avatars.com/api/?name=User'
                  "
                  alt=""
                  class="rounded-full object-cover ring-2 ring-primary transition-all duration-200"
                />
              </button>
            </div>
            <!-- Guest User Actions -->
          } @else {
            <div class="flex items-center gap-2 ml-auto">
              @for (item of guestNavigation(); track item) {
                <a
                  matButton
                  [routerLink]="item.href"
                  class="px-4 py-2 font-medium transition-all duration-200 text-on-surface hover-primary cursor-pointer"
                >
                  <mat-icon class="mr-2 text-sm">{{ item.icon }}</mat-icon>
                  {{ item.name }}
                </a>
              }
            </div>
          }
        }

        <!-- Mobile Menu Button -->
        @if (isHandset$ | async) {
          <button
            mat-icon-button
            (click)="toggleMenu()"
            class="ml-auto text-on-surface hover-primary transition-all duration-200"
          >
            <mat-icon>menu</mat-icon>
          </button>
        }
      </div>
    </mat-toolbar>

    <!-- User Menu -->
    <mat-menu
      #userMenu="matMenu"
      class="bg-surface backdrop-blur-md border border-outline shadow-xl"
    >
      @for (item of userNavigation(); track item) {
        <a
          mat-menu-item
          [routerLink]="item.href"
          (click)="item.action?.()"
          class="flex items-center gap-3 py-3 px-4 hover-primary transition-all duration-200 cursor-pointer"
        >
          <span class="font-medium">{{ item.name }}</span>
        </a>
      }
    </mat-menu>

    <!-- Main Content Area -->
    <div class="max-w-7xl mx-auto bg-surface-variant px-4 sm:px-6 lg:px-8 flex-1">
      <router-outlet />
    </div>

    <!-- Footer -->
    <div class="mt-auto bg-surface backdrop-blur-sm border-t border-outline shadow-lg">
      <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8 flex items-center justify-between">
        <span class="text-on-surface-variant font-medium">Voltera &copy; 2025</span>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
