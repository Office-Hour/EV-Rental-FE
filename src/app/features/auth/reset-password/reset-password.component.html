<div
  class="flex min-h-screen items-center justify-center bg-surface-container-lowest px-4 py-12 sm:px-6 lg:px-8"
>
  <div class="w-full max-w-md space-y-8">
    <!-- Password Reset Success State -->
    @if (isPasswordReset()) {
      <!-- Success Icon -->
      <div
        class="mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-success-container"
      >
        <mat-icon class="text-2xl text-on-success-container">check_circle</mat-icon>
      </div>

      <!-- Success Header -->
      <div class="text-center">
        <h1 class="text-3xl font-bold tracking-tight text-on-surface">Password reset successful</h1>
        <p class="mt-2 text-sm text-on-surface-variant">
          Your password has been successfully updated. You can now sign in with your new password.
        </p>
      </div>

      <!-- Success Message -->
      <div class="rounded-lg bg-surface-container p-6 text-center">
        <p class="text-sm text-on-surface-variant">
          For security reasons, we recommend using a strong, unique password.
        </p>
      </div>

      <!-- Back to Sign In -->
      <button matButton="filled" type="button" class="w-full" href="/sign-in" color="primary">
        <mat-icon class="mr-2">login</mat-icon>
        Sign in now
      </button>
    }

    <!-- Password Reset Form State -->
    @else {
      <!-- Icon -->
      <div
        class="mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-primary-container"
      >
        <mat-icon class="text-2xl text-on-primary-container">lock_reset</mat-icon>
      </div>

      <!-- Header -->
      <div class="text-center">
        <h1 class="text-3xl font-bold tracking-tight text-on-surface">Reset your password</h1>
        <p class="mt-2 text-sm text-on-surface-variant">
          Enter your new password below. Make sure it's strong and secure.
        </p>
      </div>

      <!-- Reset Password Form -->
      <form [formGroup]="resetPasswordForm" (ngSubmit)="resetPassword()" class="mt-8 space-y-6">
        <!-- New Password Field -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>New password</mat-label>
          <input
            matInput
            [type]="hidePassword() ? 'password' : 'text'"
            formControlName="password"
            autocomplete="new-password"
            placeholder="Enter your new password"
            required
          />
          <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="togglePasswordVisibility()"
            [attr.aria-label]="hidePassword() ? 'Show password' : 'Hide password'"
            [attr.aria-pressed]="!hidePassword()"
          >
            <mat-icon>{{ hidePassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          @if (
            resetPasswordForm.get('password')?.invalid && resetPasswordForm.get('password')?.touched
          ) {
            <mat-error>
              @if (resetPasswordForm.get('password')?.hasError('required')) {
                Password is required
              } @else if (resetPasswordForm.get('password')?.hasError('minlength')) {
                Password must be at least 8 characters
              } @else if (resetPasswordForm.get('password')?.hasError('passwordRequirements')) {
                Password must contain at least one uppercase letter and one number
              }
            </mat-error>
          }
        </mat-form-field>

        <!-- Password Requirements -->
        @if (resetPasswordForm.get('password')?.value) {
          <div class="rounded-lg bg-surface-container p-4 space-y-2">
            <p class="text-sm font-medium text-on-surface">Password requirements:</p>
            <div class="space-y-1">
              <div class="flex items-center space-x-2 text-sm">
                <mat-icon
                  class="text-sm"
                  [class.text-error]="!getPasswordRequirements().hasMinLength"
                  [class.text-success]="getPasswordRequirements().hasMinLength"
                >
                  {{ getPasswordRequirements().hasMinLength ? 'check_circle' : 'cancel' }}
                </mat-icon>
                <span
                  [class.text-error]="!getPasswordRequirements().hasMinLength"
                  [class.text-success]="getPasswordRequirements().hasMinLength"
                >
                  At least 8 characters
                </span>
              </div>
              <div class="flex items-center space-x-2 text-sm">
                <mat-icon
                  class="text-sm"
                  [class.text-error]="!getPasswordRequirements().hasUpperCase"
                  [class.text-success]="getPasswordRequirements().hasUpperCase"
                >
                  {{ getPasswordRequirements().hasUpperCase ? 'check_circle' : 'cancel' }}
                </mat-icon>
                <span
                  [class.text-error]="!getPasswordRequirements().hasUpperCase"
                  [class.text-success]="getPasswordRequirements().hasUpperCase"
                >
                  At least one uppercase letter (A-Z)
                </span>
              </div>
              <div class="flex items-center space-x-2 text-sm">
                <mat-icon
                  class="text-sm"
                  [class.text-error]="!getPasswordRequirements().hasDigit"
                  [class.text-success]="getPasswordRequirements().hasDigit"
                >
                  {{ getPasswordRequirements().hasDigit ? 'check_circle' : 'cancel' }}
                </mat-icon>
                <span
                  [class.text-error]="!getPasswordRequirements().hasDigit"
                  [class.text-success]="getPasswordRequirements().hasDigit"
                >
                  At least one number (0-9)
                </span>
              </div>
            </div>
          </div>
        }

        <!-- Confirm Password Field -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Confirm new password</mat-label>
          <input
            matInput
            [type]="hideConfirmPassword() ? 'password' : 'text'"
            formControlName="confirmPassword"
            autocomplete="new-password"
            placeholder="Confirm your new password"
            required
          />
          <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="toggleConfirmPasswordVisibility()"
            [attr.aria-label]="hideConfirmPassword() ? 'Show password' : 'Hide password'"
            [attr.aria-pressed]="!hideConfirmPassword()"
          >
            <mat-icon>{{ hideConfirmPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          @if (
            resetPasswordForm.get('confirmPassword')?.invalid &&
            resetPasswordForm.get('confirmPassword')?.touched
          ) {
            <mat-error>
              @if (resetPasswordForm.get('confirmPassword')?.hasError('required')) {
                Please confirm your password
              }
            </mat-error>
          }
          @if (
            resetPasswordForm.hasError('passwordMismatch') &&
            resetPasswordForm.get('confirmPassword')?.touched
          ) {
            <mat-error> Passwords do not match </mat-error>
          }
        </mat-form-field>

        <!-- Reset Password Button -->
        <button
          matButton="filled"
          type="submit"
          class="w-full"
          [disabled]="isLoading() || resetPasswordForm.invalid"
          color="primary"
        >
          @if (isLoading()) {
            <mat-spinner diameter="20" class="mr-2"></mat-spinner>
            Updating password...
          } @else {
            Reset password
          }
        </button>
      </form>

      <!-- Back to Sign In Link -->
      <p class="mt-8 text-center text-sm text-on-surface-variant">
        Remember your password?
        <a href="/sign-in" class="font-medium text-primary hover:text-primary-container underline">
          Sign in here
        </a>
      </p>
    }
  </div>
</div>
